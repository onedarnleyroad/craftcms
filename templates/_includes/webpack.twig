{# 

	This file spins up basic webpack compiled things. 

	It's also going to include styles from webpack / tailwind
	based on the default approach, so ensure it's in the head. 

	The results of the _readonly/html/[env]_app.twig file are compiled
	from `./src/html/scripts.html` so, look there to see what's happening.

	Our typical install relies on the setCookie plugin and our oneconfig,
	so you'll get errors if that's not spun up (at least, in production mode).


	
#}


{# Polyfills #}
<script>
{# Object.entries is very useful and I use it a lot, so let's be sure it's there #}
if (!Object.entries) {
	Object.entries = function (obj) {
		var ownProps = Object.keys(obj),
			i = ownProps.length,
			resArray = new Array(i); // preallocate the Array
		while (i--)
			resArray[i] = [ownProps[i], obj[ownProps[i]]];

		return resArray;
	};
}

{# 
	Fix nomodule bug for safari.
	https://gist.github.com/samthor/64b114e4a4f539915a95b91ffd340acc 
#}
!function(){var e=document,t=e.createElement("script");if(!("noModule"in t)&&"onbeforeload"in t){var n=!1;e.addEventListener("beforeload",function(e){if(e.target===t)n=!0;else if(!e.target.hasAttribute("nomodule")||!n)return;e.preventDefault()},!0),t.type="module",t.src=".",e.head.appendChild(t),t.remove()}}();
</script>
{# Nomodule - include polys for IE11 basically. We don't really need catch-all polyfills for other browsers #}
<script nomodule src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
<script nomodule src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.3/picturefill.min.js"></script>

{# Webpack: #}
{% if craft.one.config('environment') == 'local' %}
	{% if craft.one.config('webpackOn') %}
		{% set devAssetPath = 'https://localhost:9000/assets/development/' %}
	{% else %}
		{% set devAssetPath = '/assets/development/' %}
	{% endif %}
	
	{% include "_readonly/html/development_app.twig" with { devAssetPath: devAssetPath } only %}
	{# {% include "_readonly/html/legacy_app.twig" with { devAssetPath: devAssetPath } only %} #}
{% else %}
	{% include "_readonly/html/production_app.twig" %}
	{% include "_readonly/html/legacy_app.twig" %}
{% endif %}